YUI.add("ya-UPLOAD",function(a){a.namespace("Answers.UPLOAD");a.Answers.UPLOAD=function(z){var p=this;var c={};var x;var r;var l;var j=0;var f=0;var h=0;var n="shared-sprite";var d="warning-icon";var e="shared-sprite";var u="media-icon";if(ANSWERS.isQuestionPage){n="qna-sprite";d="qna-warning-icon";e="qna-sprite";u="qna-media-icon"}var k=function(G){if(G.node&&!G.node.inViewportRegion(G.node,false)){var B=a.DOM.winHeight(),F=a.DOM.docScrollY(),E=G.node,C=E.getY()-F,A=E.get("offsetHeight");var D=(C+A)-B;if(D>0){window.scrollBy(0,D)}}},g=function(B){var A=B.fileList;a.each(A,function(E){if(E.get("name").match(/\.(3gp|3gpp|mp4|mov|avi|mpg|mpeg|rm)$/ig)!=null){f=1}if(((E.get("name").match(/\.(png|jpg|jpeg)$/ig)!=null)&&(E.get("size")<5000000))||((E.get("name").match(/\.(3gp|3gpp|mp4|mov|avi|mpg|mpeg|rm)$/ig)!=null)&&(E.get("size")<600000000))){a.one("#mm-rev-area").removeClass("none");var D=a.one("#dockable-answer-box");if(D&&D.hasClass("dockedAnswerBox")){D.removeClass("dockedAnswerBox");var C=a.one("#ya-answer");if(C&&!C.hasClass("answered")){k({node:C})}}if(ANSWERS.isQuestionPage){a.one("#mm-rev-area").setStyle("borderTop","1px solid #F4F4FC");a.one("#mm-rev-area").setHTML('<div class="yui3-progressbar-label1"> <div id="upld-msg" style="display: inline;">'+YUI.Env._l10n.getTranslation("MULTIMEDIA.UPLOAD_IN_PROGRESS")+'</div> <span class="prg-ticker"></span> (<div id="cancel-upload" style="cursor: pointer; display: inline; color: #324fe1;" >'+YUI.Env._l10n.getTranslation("MULTIMEDIA.CANCEL_UPLOAD")+'</div>) </div> <div id="mm-progress-bar" class="yui3-progressbar yui3-progressbar-content"> <div class="yui3-progressbar-slider" style="width: 0;"> </div> </div> <div class="yui3-progressbar-label"><span id="prg-lbl">0</span>%</div>')}else{a.one("#mm-rev-area").setHTML(' <div class="yui3-progressbar-label1"> <div id="upld-msg" style="display: inline;">'+YUI.Env._l10n.getTranslation("MULTIMEDIA.UPLOAD_IN_PROGRESS")+'</div> <span class="prg-ticker"></span> (<div id="cancel-upload" style="cursor: pointer; display: inline; color: #324fe1;" >'+YUI.Env._l10n.getTranslation("MULTIMEDIA.CANCEL_UPLOAD")+'</div>)</div> <div id="mm-progress-bar" class="yui3-progressbar yui3-progressbar-content"> <div class="yui3-progressbar-slider" style="width: 0;"> </div> </div> <div class="yui3-progressbar-label"><span id="prg-lbl">0</span>%</div> ')}r.set("enabled",false);if(ANSWERS.isQuestionPage){if(j==0){if(a.one("#deleteMM")){a.one("#deleteMM").addClass("disabled");a.one("#deleteMM").set("disabled",true)}a.one("#submitAnswer").addClass("disabled");a.one("#submitAnswer").set("disabled",true);j=1}}else{if(!a.one("#ya-ask-form").one(".continue").hasClass("disabled")){a.one("#ya-ask-form").one(".continue").addClass("disabled");j=1}}r.uploadAll()}else{t(B);if(E.get("name").match(/\.(3gp|3gpp|mp4|mov|avi|mpg|mpeg|rm|png|jpg|jpeg)$/ig)==null){a.one("#mm-rev-area").setHTML('<div id="upld-err-msg" class="error"><span style="margin: 7px; margin-right: 9px;" class="shared-img-sprite '+n+" "+d+'"></span><div>'+YUI.Env._l10n.getTranslation("MULTIMEDIA.UPLOAD_FAILED_YOU_CAN_ONLY_UPLOAD_PHOTO_VIDEO_EXTNS")+"</div></div>")}else{if((E.get("name").match(/\.(png|jpg|jpeg)$/ig)!=null)&&(E.get("size")>=5000000)){a.one("#mm-rev-area").setHTML('<div id="upld-err-msg" class="error"><span style="margin-right: 9px;" class="shared-img-sprite '+n+" "+d+'"></span><div>'+YUI.Env._l10n.getTranslation("MULTIMEDIA.UPLOAD_FAILED_YOU_CAN_ONLY_UPLOAD_PHOTOS_SMALLER_THAN_5_MB")+"</div></div>")}else{if((E.get("name").match(/\.(3gp|3gpp|mp4|mov|avi|mpg|mpeg|rm)$/ig)!=null)&&(E.get("size")>=600000000)){a.one("#mm-rev-area").setHTML('<div id="upld-err-msg" class="error"><span style="margin-right: 9px;" class="shared-img-sprite '+n+" "+d+'"></span><div>'+YUI.Env._l10n.getTranslation("MULTIMEDIA.UPLOAD_FAILED_YOU_CAN_ONLY_UPLOAD_VIDEOS_SMALLER_THAN_600MB")+"</div></div>")}}}a.one("#mm-rev-area").removeClass("none");a.later(5000,this,function(F){a.one("#upld-err-msg").remove(true);a.one("#mm-rev-area").addClass("none")})}})},m=function(C){var A=a.one(".yui3-progressbar-slider");l=a.one(".yui3-progressbar").get("offsetWidth")-4;var B=Math.round(100*(C.bytesLoaded/C.bytesTotal))*l/100;a.one(".yui3-progressbar-slider").setStyle("width",(B>l?l:B));var D=Math.round(100*(C.bytesLoaded/C.bytesTotal));a.one("#prg-lbl").setHTML((D>100?100:D));x=C.bytesLoaded},i=function(A){r.set("enabled",false)},o=function(B,D){if(h==0){var A={headers:{Accept:"application/json"},on:{success:function(F,E){D(E)}},xdr:{use:"native",credentials:true},timeout:5000};a.io(B+"&t="+Math.random(),A)}else{if(ANSWERS.isQuestionPage){YUI.Env._io.makeRequest("/xhr-q-mmToken.php?t="+Math.random()+"&crumb="+ANSWERS.crumb,"POST","uri="+B,function(E){D(E)})}else{var C=new a.Answers.IO();C.makeRequest("/xhr-q-mmToken.php?t="+Math.random()+"&crumb="+ANSWERS.crumb,"POST","uri="+B,function(E){D(E)})}}},v=function(F){var A=null;var G="";if(ANSWERS.isQuestionPage){G="<div id='preview-window' class='mm-img'> <div id='prev-img-area' > <div class='prev-close' id='preview-close'> </div> <div id='gen-preview' style=' position: absolute; font-weight: 600; text-align: center; width: 100%; margin-top: 27px; margin-left: -26px;'>"+YUI.Env._l10n.getTranslation("MULTIMEDIA.GENERATING_PREVIEW")+"</div> <img id='prev-img' style='display: none;' width='392' height='221' src='none'></div> </div>";if(f==1){G+='<div id="preview-mm-vid" class="none"> </div>'}a.one("#mm-rev-area").setHTML(G);a.one(".prev-close").on("click",function(H){if(A!=null){clearInterval(A)}t(H)})}else{G="<div id='preview-window' class='mm-img'>  <div id='prev-img-area' >  <div class='prev-close' id='preview-close'> </div>  <div id='gen-preview' style=' position: absolute; font-weight: 600; text-align: center; width: 100%; margin-top: 27px; margin-left: -26px;'>"+YUI.Env._l10n.getTranslation("MULTIMEDIA.GENERATING_PREVIEW")+"</div>  <img id='prev-img' style='display: none;' width='392' height='221' src='none'>  </div> </div>";a.one("#mm-rev-area").setHTML(G);a.one(".prev-close").on("click",function(H){if(A!=null){clearInterval(A)}t(H)})}var E=a.JSON.parse(F.data);var B=E.uri;var C;var D=0;A=setInterval(function(){o(B+"?crumb="+ANSWERS.crumb,function(K){C=a.JSON.parse(K.responseText);if(C){if(C.status=="FAILED"){t(F);if(!a.one("upld-err-msg")){if(C.responseCode=="1001"){a.one("#mm-rev-area").setHTML('<div id="upld-err-msg" class="error"><span style="margin-right: 9px;" class="shared-img-sprite '+n+" "+d+'"></span><div>'+YUI.Env._l10n.getTranslation("MULTIMEDIA.UPLOAD_FAILED_PIXELS_ERROR_MSG")+"</div></div>")}else{a.one("#mm-rev-area").setHTML('<div id="upld-err-msg" class="error"><span style="margin-right: 9px;" class="shared-img-sprite '+n+" "+d+'"></span><div>'+YUI.Env._l10n.getTranslation("MULTIMEDIA.UPLOAD_FAILED_UPLOAD_ENCOUNTERED_PROBLEMS_PLEASE_TRY_AGAIN_LATER")+"</div></div>")}}a.one("#mm-rev-area").removeClass("none");clearInterval(A);a.later(5000,this,function(M){a.one("#upld-err-msg").remove(true);a.one("#mm-rev-area").addClass("none")})}if(C.canAssociateContent==true){clearInterval(A);var J="";var H="";previewUrl="";a.Array.each(C.mediaRecords,function(M,N){if(M.spec=="IMAGE_640_472"){J=M.url}if(M.spec=="IMAGE_250_200"){H=M.url}});previewUrl=J;if(J==""){previewUrl=H}if(ANSWERS.isQuestionPage){var I=a.one("#slcted-mm-id");if(!I){a.one(".answer-form").append(a.Node.create('<input id="slcted-mm-id" type="hidden" name="mid" value="'+C.id+'">'))}else{I.set("value",C.id)}var L=C.id;a.one("#prev-img").set("src",previewUrl);a.one("#prev-img").on("load",function(M){a.one("#prev-img-area").setStyle("height","auto");a.one("#gen-preview").remove(true);a.one("#prev-img").setStyle("display","block");if(f==1){var N=a.Node.create('<div style="margin-top: 10px;" class="feedback-cont fwb fs15 mb10" id="upld-vid-tip">'+YUI.Env._l10n.getTranslation("MULTIMEDIA.ANSWER_UPLOADED_VIDEO_IS_BEING_PROCESSED_AND_WILL_BE_LIVE_SOON")+"</div>");a.one("#preview-window").append(N)}});if(j==1){if(a.one("#deleteMM")){a.one("#deleteMM").removeClass("disabled");a.one("#deleteMM").set("disabled",false)}a.one("#submitAnswer").removeClass("disabled");a.one("#submitAnswer").set("disabled",false);j=0}D=1}else{var I=a.one("#mm-ask-id").set("value",C.id);a.one("#prev-img").set("src",previewUrl);a.one("#prev-img").on("load",function(M){a.one("#gen-preview").remove(true);a.one("#prev-img-area").setStyle("height","auto");a.one("#prev-img").setStyle("display","block");if(f==1){var N=a.Node.create('<div style="margin-top: 10px;" class="feedback-cont fwb fs15 mb10" id="upld-vid-tip">'+YUI.Env._l10n.getTranslation("MULTIMEDIA.QUESTION_UPLOADED_VIDEO_IS_BEING_PROCESSED_AND_WILL_BE_LIVE_SOON")+"</div>");a.one(".mm-img").append(N)}});if(j==1){a.one("#ya-ask-form").one(".continue").removeClass("disabled");j=0}D=1}}}})},3000);a.later(300000,this,function(){clearInterval(A);if(D==0){t(F);if(!a.one("upld-err-msg")){a.one("#mm-rev-area").setHTML('<div id="upld-err-msg" class="error"><span style="margin-right: 9px;" class="shared-img-sprite '+n+" "+d+'"></span><div>'+YUI.Env._l10n.getTranslation("MULTIMEDIA.UPLOAD_FAILED_UPLOAD_ENCOUNTERED_PROBLEMS_PLEASE_TRY_AGAIN_LATER")+"</div></div>")}a.one("#mm-rev-area").removeClass("none");a.later(5000,this,function(H){a.one("#upld-err-msg").remove(true);a.one("#mm-rev-area").addClass("none")})}});r.set("fileList",[])},b=function(A){a.one("#mm-rev-area").setHTML('<div class="yui3-progressbar-label">'+YUI.Env._l10n.getTranslation("MULTIMEDIA.SOMETHING_HAS_GONE_WRONG_WITH_UPLOAD_PLEASE_TRY_AGAIN")+"</div>");a.later(2000,this,function(B){t(B)})},y=function(A){if(!A.currentTarget.hasClass("disabled")){a.one("#mm-rec-id").set("value","");a.one("#deleteMM").remove(true);t(A);a.one("#MMuploadbutton").setHTML('<div class="shared-img-sprite '+e+" "+u+'"></div> <div style="font-weight: 600; font-size: 13px; color: #2F49E5;">'+YUI.Env._l10n.getTranslation("MULTIMEDIA.ADD_MEDIA")+"</div>");a.one("#MMuploadbutton").setStyle("width","90")}},t=function(A){if(ANSWERS.isQuestionPage){f=0;a.one("#mm-rev-area").addClass("none");if(h==0){a.one("#MMuploadbutton").removeClass("none");a.one("#uploadMM").setHTML('<div id="MMuploadbutton" style="float: left; width: 90px; margin: 9px 0 9px 9px;"> <div class="shared-img-sprite '+e+" "+u+'"></div><div style="font-weight: 600; font-size: 13px; color: #2F49E5;">'+YUI.Env._l10n.getTranslation("MULTIMEDIA.ADD_MEDIA")+"</div> </div> ")}var B=a.one("#slcted-mm-id");if(B){B.set("value","")}a.one("#mm-rev-area").setHTML('<div id="mm-progress-bar" class="yui3-progressbar yui3-progressbar-content"> <div class="yui3-progressbar-slider" style="width: 0;"> </div> </div> <div class="yui3-progressbar-label"><span id="prg-lbl">0</span>%</div> </div>');r.set("fileList",[]);r.set("enabled",true);if(j==1){if(a.one("#deleteMM")){a.one("#deleteMM").removeClass("disabled");a.one("#deleteMM").set("disabled",false)}a.one("#submitAnswer").removeClass("disabled");a.one("#submitAnswer").set("disabled",false);if(a.one("#mm-action-panel")){a.one("#mm-action-panel").removeClass("none")}if((h==0)&&(a.one("#upload-tip"))){a.one("#upload-tip").addClass("none")}s();j=0}}else{f=0;a.one("#mm-rev-area").addClass("none");if(h==0){a.one("#MMuploadbutton").removeClass("none");a.one("#uploadMM").setHTML('<div id="MMuploadbutton" style="cursor: pointer; padding: 14px 0;float: left; width: 100px;"> <i id="mm-tip-icon" class="shared-img-sprite '+e+" "+u+'"></i> <span id="mm-tip-text" style="font-weight: 600; font-size: 13px; color: #2F49E5;">'+YUI.Env._l10n.getTranslation("MULTIMEDIA.ADD_MEDIA")+"</span> </div>")}a.one("#mm-ask-id").set("value","");a.one("#mm-rev-area").setHTML(' <div class="yui3-progressbar-label1"> <div id="upld-msg" style="display: inline;">'+YUI.Env._l10n.getTranslation("MULTIMEDIA.UPLOAD_IN_PROGRESS")+'</div> <span class="prg-ticker"></span> (<div id="cancel-upload" style="cursor: pointer; display: inline; color: #324fe1;" >'+YUI.Env._l10n.getTranslation("MULTIMEDIA.CANCEL_UPLOAD")+'</div>)</div> <div id="mm-progress-bar" class="yui3-progressbar yui3-progressbar-content"> <div class="yui3-progressbar-slider" style="width: 0;"> </div> </div> <div class="yui3-progressbar-label"><span id="prg-lbl">0</span>%</div> ');r.set("fileList",[]);if(a.one("#mm-action-panel")){a.one("#mm-action-panel").removeClass("none")}if(h==0){if(a.one("#upload-tip")){a.one("#upload-tip").addClass("none")}}r.set("enabled",true);if(j==1){a.one("#ya-ask-form").one(".continue").removeClass("disabled");j=0}}},q=function(A){if(ANSWERS.isQuestionPage){if(a.one("#flashuploadbutton")){a.one("#flashuploadbutton").remove(true)}if(r.queue!=null){r.queue.cancelUpload();w();r.set("enabled",true);a.later(10000,this,function(B){if(a.one("#slcted-mm-id")){a.one("#slcted-mm-id").set("value","")}})}t(A)}else{if(a.one("#flashuploadbutton")){a.one("#flashuploadbutton").remove(true)}if(r.queue!=null){r.queue.cancelUpload();w();r.set("enabled",true);a.one("#mm-ask-id").set("value","")}t(A)}},s=function(){if(ANSWERS.isQuestionPage){var B=h!==1?a.one("#MMuploadbutton"):a.one("#uploadMM1"),A=a.one("#upload-tip");if(A){A.setStyle("marginLeft",parseFloat(B.getComputedStyle("width")))}if(B&&A){B.on("mouseenter",function(){A.removeClass("none")});B.on("mouseout",function(){A.addClass("none")})}}else{var B=h!==1?a.one("#uploadMM"):a.one("#uploadMM1"),A=a.one("#upload-tip");if(B&&A){if(h==0){B.delegate("mouseenter",function(){A.removeClass("none")},"#mm-tip-text, #mm-tip-icon, #MMuploadbutton")}else{A.setStyle("marginLeft",parseFloat(B.getComputedStyle("width"))+20);B.on("mouseenter",function(){A.removeClass("none")})}B.on("mouseout",function(){A.addClass("none")})}}},w=function(){r=new a.Uploader({multipleFiles:false,uploadURL:ANSWERS.uploadUrl+"&crumb="+ANSWERS.crumb+"&lang="+ANSWERS.lang,simLimit:2,withCredentials:true,fileFieldName:"content"});if(a.Uploader.TYPE=="html5"){r.set("selectFilesButton",a.one("#uploadMM"))}else{if(a.Uploader.TYPE=="flash"){h=1;if(a.one("#MMuploadbutton")){a.one("#MMuploadbutton").remove(true)}if(ANSWERS.isQuestionPage){r.set("selectFilesButton",a.Node.create('<div id="flashuploadbutton" class="ya-button bg-purple brd-rad2 fwb">'+YUI.Env._l10n.getTranslation("MULTIMEDIA.ADD_MEDIA")+"</div>"))}else{r.set("selectFilesButton",a.Node.create('<div id="flashuploadbutton" style="padding: 1px;" class="ya-button bg-purple brd-rad2">'+YUI.Env._l10n.getTranslation("MULTIMEDIA.ADD_MEDIA")+"</div>"))}r.set("swfURL","/static/player/flashuploader.swf?t="+Math.random())}else{a.log("No Flash or HTML5 capabilities detected.")}}if(a.one("#uploadMM")){if(ANSWERS.isQuestionPage){a.all("#uploadMM").on("click",this.uploadFiles)}a.one("#uploadMM").removeClass("yui3-button-disabled");r.render("#uploadMM1");r.on("fileselect",g);r.on("uploadprogress",m);r.on("uploadstart",i);r.on("uploadcomplete",v);r.on("uploaderror",b);if(a.one("#mm-rev-area")){a.one("#mm-rev-area").delegate("click",q,"#cancel-upload")}if((ANSWERS.isQuestionPage)&&(a.one("#deleteMM"))){a.one("#deleteMM").on("click",y)}}if(!ANSWERS.isQuestionPage){r.set("fileList",[]);r.set("enabled",true)}};w();s()}},"0.1",{requires:["uploader","base","node","event","json","io-xdr","ya-io","ya-translator"]});